<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>åˆ†æå ±å‘Š</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
  <style>
    body {
      background: linear-gradient(to right, rgba(0, 123, 255, 0.1), rgba(0, 123, 255, 0.3)),
                  url('https://via.placeholder.com/1500x1000/87CEFA/ffffff?text=Background+Image') no-repeat center center fixed;
      background-size: cover;
      font-family: 'DFKai-SB', 'æ¨™æ¥·é«”', serif;
      color: #333;
    }

    .container {
      max-width: 900px;
      margin-top: 40px;
      background: rgba(255, 255, 255, 0.95);
      padding: 25px;
      border-radius: 12px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    }

    h2 {
      text-align: center;
      color: #343a40;
      margin-bottom: 20px;
      font-weight: 700;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    h4 {
      margin-top: 30px;
      padding-bottom: 8px;
      border-bottom: 2px solid #007bff;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    h4::before {
      content: "ğŸ“Š";
      font-size: 1.2em;
    }

    .info-icon {
      margin-left: 10px;
      cursor: pointer;
      color: #007bff;
      font-size: 20px;
      transition: transform 0.2s;
    }

    .info-icon:hover {
      transform: scale(1.2);
    }

    .highlight {
      background-color: #f8d7da;
      font-weight: bold;
    }

    .warning {
      background-color: #fff3cd;
      font-weight: bold;
    }

    .success {
      background-color: #d4edda;
      font-weight: bold;
    }

    .table-responsive {
      overflow-x: auto;
    }

    .btn-secondary i {
      margin-right: 6px;
    }

    @media (max-width: 768px) {
      .container {
        padding: 15px;
      }
      h2 {
        font-size: 24px;
      }
      .table th, .table td {
        font-size: 14px;
      }
    }
  </style>
</head>
<body>

<div class="container">
  <h2>åˆ†æå ±å‘Š
    <span id="info-icon" class="info-icon">
      <i class="bi bi-info-circle-fill"></i>
    </span>
  </h2>

  <% let queryStringParam = isUser ? "user_id" : "man_user_id"; %>
  <% let recordId = userId || manUserId; %>
  <% const { attachment, knowledge, sleep, dour } = analysisData; %>

  <p><i class="bi bi-person-badge-fill me-1"></i><strong>IDï¼š</strong> <%= recordId || 'å°šæœªæä¾›' %></p>
  <p><i class="bi bi-person-fill me-1"></i><strong>åå­—ï¼š</strong> <%= user_name || 'å°šæœªæä¾›' %></p>

  <% if (isUser) { %>
  <h4>è¦ªå¯†ä¾é™„å››é‡è¡¨</h4>
  <div class="table-responsive">
    <table class="table table-bordered">
      <% if (attachment) { %>
      <tr>
        <td>æ¯å¬°è¦ªè¿‘ç‹€æ³</td>
        <td class="<%= attachment.attachment_score_a >= 34 ? 'success' : 'highlight' %>"><%= attachment.attachment_score_a ?? '-' %></td>
        <td><%= attachment.attachment_score_a >= 34 ? 'æ¯å¬°è¦ªè¿‘ç‹€æ³è‰¯å¥½' : 'æ¯å¬°è¦ªè¿‘ç‹€æ³ä¸ä½³' %></td>
      </tr>
      <tr>
        <td>è¦ªè·é©æ‡‰</td>
        <td class="<%= attachment.attachment_score_b < 18 ? 'success' : 'highlight' %>"><%= attachment.attachment_score_b ?? '-' %></td>
        <td><%= attachment.attachment_score_b < 18 ? 'æ¯è¦ªè¦ªè·é©æ‡‰è‰¯å¥½' : 'æ¯è¦ªè¦ªè·é©æ‡‰ä¸ä½³' %></td>
      </tr>
      <tr>
        <td>ç…§é¡§è²¬ä»»</td>
        <td class="<%= attachment.attachment_score_c >= 24 ? 'success' : 'highlight' %>"><%= attachment.attachment_score_c ?? '-' %></td>
        <td><%= attachment.attachment_score_c >= 24 ? 'é¡˜æ„ç…§é¡§å­©å­' : 'ä¸å¤ªé¡˜æ„ç…§é¡§å­©å­' %></td>
      </tr>
      <tr>
        <td>å›æ‡‰ä¿¡å¿ƒ</td>
        <td class="<%= attachment.attachment_score_d >= 22 ? 'success' : 'highlight' %>"><%= attachment.attachment_score_d ?? '-' %></td>
        <td><%= attachment.attachment_score_d >= 22 ? 'æœ‰ä¿¡å¿ƒäº†è§£å¬°å…’éœ€æ±‚' : 'ç¼ºä¹ä¿¡å¿ƒäº†è§£å¬°å…’éœ€æ±‚' %></td>
      </tr>
      <% } else { %>
      <tr><td colspan="3" class="warning">å°šç„¡è¦ªå¯†ä¾é™„è³‡æ–™</td></tr>
      <% } %>
    </table>
  </div>
  <% } %>

  <h4>çŸ¥è­˜é‡è¡¨ (ç¸½åˆ†+è©•èª)</h4>
  <div class="table-responsive">
    <table class="table table-bordered">
      <% if (knowledge && knowledge.knowledge_score !== undefined) { %>
      <tr>
        <td class="<%= knowledge.knowledge_score >= 80 ? 'success' : (knowledge.knowledge_score >= 60 ? 'warning' : 'highlight') %>">
          <%= knowledge.knowledge_score %>
        </td>
        <td>
          <% if (knowledge.knowledge_score >= 80) { %> å„ªç§€
          <% } else if (knowledge.knowledge_score >= 60) { %> æ™®é€š
          <% } else { %> éœ€è¦åŠ å¼· <% } %>
        </td>
      </tr>
      <% } else { %>
      <tr><td colspan="2" class="warning">å°šç„¡çŸ¥è­˜æ¸¬é©—è³‡æ–™</td></tr>
      <% } %>
    </table>
  </div>

  <h4>ç¡çœ å“è³ª</h4>
  <div class="table-responsive">
    <table class="table table-bordered">
      <% if (sleep && sleep.sleep_score_total !== undefined) { %>
      <tr>
        <td class="<%= sleep.sleep_score_total <= 5 ? 'success' : 'highlight' %>"><%= sleep.sleep_score_total %></td>
        <td><%= sleep.sleep_score_total <= 5 ? 'ç¡çœ å“è³ªæ­£å¸¸' : 'ç¡çœ å“è³ªä¸ä½³' %></td>
      </tr>
      <% } else { %>
      <tr><td colspan="2" class="warning">å°šç„¡ç¡çœ è©•ä¼°è³‡æ–™</td></tr>
      <% } %>
    </table>
  </div>

<h4>æ†‚é¬±é‡è¡¨</h4>
<table class="table table-bordered">
    <% if (dour && dour.dour_score !== undefined) { %>
    <tr>
        <td class="<%= dour.dour_score <= 6 ? '' : (dour.dour_score <= 13 ? 'warning' : 'highlight') %>">
            <%= dour.dour_score %>
        </td>
        <td>
            <% if (dour.dour_score <= 6) { %>
                ç„¡æˆ–æ¥µè¼•å¾®æ†‚é¬±
            <% } else if (dour.dour_score <= 13) { %>
                è¼•åº¦æ†‚é¬±
            <% } else if (dour.dour_score <= 19) { %>
                ä¸­åº¦æ†‚é¬±
            <% } else { %>
                åš´é‡æ†‚é¬±ç—‡
            <% } %>
        </td>
    </tr>
    <% } else { %>
    <tr><td colspan="2" class="warning">å°šç„¡æ†‚é¬±æŒ‡æ•¸è³‡æ–™</td></tr>
    <% } %>
</table>

        <a href="/result?<%= queryStringParam %>=<%= recordId %>" class="btn btn-secondary mt-3">è¿”å›å€‹äººè©³ç´°è³‡æ–™</a>
        <a href="/index" class="btn btn-secondary mt-3">è¿”å›è³‡æ–™æŸ¥è©¢</a>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<script>
    document.getElementById("info-icon").addEventListener("click", function() {
        var modal = new bootstrap.Modal(document.getElementById('scoreModal'));
        modal.show();
    });
</script>

</div>
</body>
</html>
