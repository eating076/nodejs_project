<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>憂鬱量表</title>
    <link rel="stylesheet" 
          href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <style>
        /* 背景設置 */
        body {
            background: linear-gradient(to right, rgba(0, 123, 255, 0.1), rgba(0, 123, 255, 0.2)), 
                        url('https://via.placeholder.com/1500x1000/87CEFA/ffffff?text=Background+Image') no-repeat center center fixed;
            background-size: cover;
            font-family: 'DFKai-SB', '標楷體', DFKai-SB, serif;
            margin: 0;
            padding: 0;
            min-height: 100vh;
        }

        /* 容器樣式設置 */
        .container {
            margin-top: 50px;
            background-color: #ffffff;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.1);
            z-index: 1;
            width: 100%;
            max-width: 950px;
            margin-left: auto;
            margin-right: auto;
        }

        /* 標題樣式 */
        h2 {
            text-align: center;
            color: #007bff;
        }

        /* 高分數強調 */
        .highlight {
            font-weight: bold;
            color: #d9534f;
        }

        /* 表格外層滾動容器 */
        .table-responsive-wrapper {
            overflow-x: auto;
        }

        /* 表格樣式 */
        .table {
            background-color: #ffffff;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            min-width: 1000px; /* 強制表格具有一定寬度供水平滾動 */
        }

        /* 響應式設置 */
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }

            h2 {
                font-size: 22px;
            }

            .table th, .table td {
                font-size: 14px;
                padding: 8px;
            }

            .btn {
                font-size: 14px;
                padding: 8px 15px;
            }
        }
    </style>
</head>
<body>

<div class="container">
    <h2 class="text-center mb-4">憂鬱量表紀錄</h2>

    <% let queryStringParam = table === "users" ? "user_id" : "man_user_id"; %>
    <% let recordId = userId || manUserId; %>
 

        <!-- 顯示使用者資訊 -->
        <p><strong>ID：</strong> <%= recordId || '未提供' %></p>
        <p><strong>名字：</strong> <%= user_name || '未提供' %></p>


    <script>
        console.log("🔍 EJS 前端收到的 recordId:", "<%= recordId %>");
    </script>

    <div class="table-responsive-wrapper">
        <table class="table table-bordered table-striped">
            <thead class="table-dark">
                <tr>
                    <th>欄位名稱</th>
                    <% assessmentsData.forEach((_, index) => { %>
                        <th>紀錄 <%= index + 1 %></th>
                    <% }); %>
                </tr>
            </thead>
<tbody>
    <tr>
        <td>ID</td>
        <% assessmentsData.forEach(item => { %>
            <td><%= item.dour_id %></td>
        <% }); %>
    </tr>
    <tr>
        <td>測驗量表</td>
        <% assessmentsData.forEach(item => { %>
            <td><%= item.dour_question_content %></td>
        <% }); %>
    </tr>
    <tr>
        <td>測驗日期</td>
        <% assessmentsData.forEach(item => { %>
            <td>
                <%= new Date(item.dour_test_date).toLocaleDateString('zh-TW', {
                    year: 'numeric', month: 'long', day: 'numeric'
                }) %>
            </td>
        <% }); %>
    </tr>

    <% const dourQuestions = [
        "我能開懷的笑並看到事物有趣的一面",
        "我能夠以快樂的心情來期待事情",
        "當事情不順利時,我會不必要地責備自己",
        "我會無緣無故感到焦慮和擔心",
        "我會無緣無故感到害怕和驚慌",
        "事情壓得我喘不過氣來",
        "我很不開心以致失眠",
        "我感到難過和悲傷",
        "我的不快樂導致我哭泣",
        "我會有傷害自己的想法"
    ]; %>

    <% dourQuestions.forEach((question, index) => { %>
        <tr>
            <td><%= question %></td>
            <% assessmentsData.forEach(item => { %>
                <td><%= item[`dour_answer_${index + 1}`] %></td>
            <% }); %>
        </tr>
    <% }); %>

    <tr>
        <td>總分</td>
        <% assessmentsData.forEach(item => { %>
            <td class="<%= item.dour_score >= 20 ? 'highlight' : '' %>">
                <%= item.dour_score %>
            </td>
        <% }); %>
    </tr>
</tbody>

        </table>
    </div>

    <a href="/result?<%= queryStringParam %>=<%= recordId %>" class="btn btn-secondary mt-3">返回個人詳細資料</a>
</div>
</body>
</html>
